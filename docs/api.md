# API Reference

All API routes are defined in `server/routes.ts`. The server runs on the same port as Vite dev server.

## REST Endpoints

### GET /api/events

Returns recent war events, ordered by timestamp (newest first). Maximum 200 events.

**Response**: `WarEvent[]`

```json
[
  {
    "id": "uuid-string",
    "type": "missile_launch",
    "title": "Ballistic missile launched from southern Iran",
    "description": "Medium-range ballistic missile detected...",
    "location": "Shiraz, Iran",
    "lat": 29.5918,
    "lng": 52.5836,
    "country": "Iran",
    "source": "Satellite Detection",
    "timestamp": "2026-02-28T10:30:00.000Z",
    "threatLevel": "critical",
    "verified": true
  }
]
```

### GET /api/statistics

Returns computed defense statistics (aggregated from war events).

**Response**: `Statistics`

```json
{
  "totalLaunches": 45,
  "totalInterceptions": 38,
  "totalHits": 7,
  "interceptionRate": 84.4,
  "activeAlerts": 3,
  "totalDrones": 12,
  "droneInterceptions": 9,
  "byCountry": {
    "Iran": { "launches": 15, "interceptions": 12 },
    "Lebanon": { "launches": 10, "interceptions": 8 }
  },
  "bySystem": {
    "ironDome": 20,
    "arrowSystem": 8,
    "davidsSling": 6,
    "thaad": 4
  }
}
```

### GET /api/news

Returns recent news items, ordered by timestamp. Maximum 100 items.

**Response**: `NewsItem[]`

```json
[
  {
    "id": "uuid-string",
    "title": "IDF confirms interception of multiple ballistic missiles",
    "source": "IDF Spokesperson",
    "timestamp": "2026-02-28T10:30:00.000Z",
    "url": null,
    "category": "Military",
    "breaking": true
  }
]
```

### GET /api/alerts

Returns Pikud HaOref alerts, ordered by timestamp. Maximum 50 alerts.

**Response**: `Alert[]`

```json
[
  {
    "id": "uuid-string",
    "area": "Tel Aviv - Gush Dan",
    "threat": "Missile threat - enter shelters immediately",
    "timestamp": "2026-02-28T10:30:00.000Z",
    "active": true,
    "lat": 32.0853,
    "lng": 34.7818
  }
]
```

### GET /api/ai-summary

Returns the latest AI situation analysis. If none exists, generates one automatically.

**Response**: `AISummary`

```json
{
  "summary": "Current situation assessment indicates...",
  "threatAssessment": "critical",
  "keyPoints": [
    "Multi-front engagement: Iran, Lebanon, Yemen, Iraq, and Gaza",
    "Israeli air defense systems operating at 84% interception rate"
  ],
  "lastUpdated": "2026-02-28T10:30:00.000Z",
  "recommendation": "Maintain maximum alert posture..."
}
```

### GET /api/health

System health check.

**Response**:

```json
{
  "status": "ok",
  "seeded": true,
  "timestamp": "2026-02-28T10:30:00.000Z"
}
```

## WebSocket

### Endpoint: /ws

The server creates a WebSocket server attached to the HTTP server. Clients receive real-time updates when new events are generated by the background data fetcher.

**Connection**: `ws://hostname:port/ws` (or `wss://` in production)

**Server-to-Client Messages**:

```json
{
  "type": "new_event",
  "event": {
    "id": "uuid-string",
    "type": "missile_launch",
    "title": "...",
    ...
  }
}
```

**Client Implementation** (from `dashboard.tsx`):

```typescript
const ws = new WebSocket(`${protocol}//${window.location.host}/ws`);
ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  if (data.type === "new_event") {
    // Prepend to events list
  }
};
```

**Reconnection**: The frontend does not currently implement automatic reconnection. If the WS connection drops, data continues flowing via REST polling.

## Frontend Polling Intervals

| Endpoint | Interval | React Query Key |
|----------|----------|-----------------|
| `/api/events` | 10,000ms | `["/api/events"]` |
| `/api/statistics` | 8,000ms | `["/api/statistics"]` |
| `/api/news` | 15,000ms | `["/api/news"]` |
| `/api/alerts` | 8,000ms | `["/api/alerts"]` |
| `/api/ai-summary` | 30,000ms | `["/api/ai-summary"]` |
