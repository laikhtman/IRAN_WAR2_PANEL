# Internationalization (i18n)

## Setup

The app uses `i18next` with `react-i18next` for translations and `i18next-browser-languagedetector` for auto-detecting browser language.

Configuration: `client/src/lib/i18n.ts`

## Supported Languages

| Code | Language | Direction | Locale File |
|------|----------|-----------|-------------|
| `en` | English | LTR | `client/src/locales/en.json` |
| `he` | Hebrew | RTL | `client/src/locales/he.json` |
| `ar` | Arabic | RTL | `client/src/locales/ar.json` |
| `fa` | Persian (Farsi) | RTL | `client/src/locales/fa.json` |

Default fallback: English (`en`)

## RTL Handling

RTL is managed at two levels:

### 1. Document Direction (`App.tsx`)

```typescript
const RTL_LANGUAGES = ["he", "ar", "fa"];

useEffect(() => {
  const lang = i18n.language.split("-")[0]; // normalize "he-IL" -> "he"
  document.documentElement.dir = RTL_LANGUAGES.includes(lang) ? "rtl" : "ltr";
  document.documentElement.lang = i18n.language;
}, [i18n.language]);
```

### 2. CSS Logical Properties

Components use Tailwind's logical property utilities instead of physical directions:
- `start-*` / `end-*` instead of `left-*` / `right-*`
- `ms-*` / `me-*` instead of `ml-*` / `mr-*`
- `ps-*` / `pe-*` instead of `pl-*` / `pr-*`

Flexbox `gap` and CSS Grid are inherently direction-agnostic.

### 3. i18n Helper (`i18n.ts`)

```typescript
export function isRTL(): boolean {
  const lang = i18n.language.split("-")[0]; // handles "he-IL", "ar-EG", etc.
  return RTL_LANGUAGES.includes(lang);
}
```

## Translation Key Structure

All locale files follow this structure:

```json
{
  "header": { "title", "connectedStatus", "disconnectedStatus", "localTime", "israelTime" },
  "stats": { "title", "missilesLaunched", "intercepted", "hits", "interceptionRate", "activeAlerts", "dronesDetected", "dronesIntercepted", "byCountry", "bySystem", "ironDome", "arrow", "davidsSling", "thaad" },
  "events": { "title", "noEvents", "verified", "unverified", "threatLevels.critical/high/medium/low", "types.missile_launch/missile_intercept/..." },
  "news": { "title", "breaking", "noNews" },
  "alerts": { "title", "active", "resolved", "noAlerts", "shelter" },
  "ai": { "title", "assessment", "keyPoints", "recommendation", "lastUpdated" },
  "map": { "legend", "eventsTracked" },
  "media": { "title", "tvChannels", "liveCameras", "live", "selectUpTo4", "channels.kan11", "channels.channel12", "channels.channel13", "channels.channel14", "channels.i24news", "channels.aljazeera", "channels.aljazeeraar", "channels.alarabiya", "channels.skynewsarabia", "cameras.jerusalem", "cameras.telaviv", "cameras.haifa", "cameras.mecca", "cameras.dubai" },
  "countries": { "Iran", "Lebanon", "Yemen", "Iraq", "Gaza", "Israel", "Jordan", "Syria", "Palestine", "International Waters", "Qatar", "UAE", "SaudiArabia" },
  "language": "Language"
}
```

## Adding a New Language

1. Create `client/src/locales/{code}.json` with all keys from `en.json`
2. Import it in `client/src/lib/i18n.ts`:
   ```typescript
   import tr from "@/locales/tr.json";
   ```
3. Add it to the `resources` object in the i18next config:
   ```typescript
   resources: {
     en: { translation: en },
     tr: { translation: tr },
     // ...
   }
   ```
4. If the language is RTL, add its code to the `RTL_LANGUAGES` array in both `i18n.ts` and `App.tsx`
5. Add the language option to `LanguageSwitcher` component (`components/language-switcher.tsx`)

## Adding New Translation Keys

1. Add the key to ALL locale files (en, he, ar, fa)
2. Use in components via `useTranslation`:
   ```typescript
   const { t } = useTranslation();
   return <span>{t("section.key")}</span>;
   ```
3. For keys with parameters:
   ```json
   { "eventsTracked": "{{count}} events tracked" }
   ```
   ```typescript
   t("map.eventsTracked", { count: events.length })
   ```

## Fallback Behavior

When a translation key is missing:

1. **Fallback language**: i18next falls back to English (`fallbackLng: 'en'` in `client/src/lib/i18n.ts`)
2. **Missing in English too**: Displays the raw key string (e.g., `media.cameras.foo`)
3. **Interpolation fallback**: Missing interpolation values show the placeholder (e.g., `{{count}}`)

This behavior is configured via i18next defaults â€” no custom handlers.

## Important Notes

- Event titles, descriptions, news headlines, and alert texts are stored in English in the database. Only UI labels and categories are translated.
- The `isRTL()` helper normalizes locale codes (e.g., `he-IL` -> `he`) before checking against the RTL list.
- Country names are translated via the `countries.*` keys.
- Defense system names and event type labels are translated via `stats.*` and `events.types.*` keys.
